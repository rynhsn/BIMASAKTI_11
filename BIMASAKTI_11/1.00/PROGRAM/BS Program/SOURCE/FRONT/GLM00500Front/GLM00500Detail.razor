@page "/GLM00500Detail"
@using GLM00500Common.DTOs
@using R_BlazorFrontEnd.Controls.Events
@inherits R_Page

<R_StackLayout Row Class="mb-3">
    <R_ItemLayout>
        <R_Label>Year</R_Label>
    </R_ItemLayout>
    <R_ItemLayout xs="1" Class="me-2">
        <R_TextBox Value="@_viewModel.BudgetHDEntity.CYEAR" Enabled="false"/>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Label>Budget</R_Label>
    </R_ItemLayout>
    <R_ItemLayout xs="1">
        <R_TextBox Value="@_viewModel.BudgetHDEntity.CBUDGET_NO" Enabled="false"/>
    </R_ItemLayout>
    <R_ItemLayout xs="3" Class="me-2">
        <R_TextBox Value="@_viewModel.BudgetHDEntity.CBUDGET_NAME" Enabled="false"/>
    </R_ItemLayout>
    <R_ItemLayout Class="me-2">
        <R_Label>Account Type</R_Label>
    </R_ItemLayout>
    <R_ItemLayout Class="me-5">
        <R_RadioGroup Data="@_viewModel.CGLACCOUNT_TYPE"
                      @bind-Value="_viewModel.SelectedAccountType"
                      ValueField="Key"
                      TextField="Value"
                      R_ConductorSource="@_conductorRef"
                      OnChanged="RefreshFormProcess"
                      R_EnableOther/>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Popup R_ConductorSource="_conductorRef" Enabled="@(_viewModel.BudgetHDEntity.LFINAL == false)" R_EnableOther>Generate</R_Popup>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Button R_ConductorSource="_conductorRef" R_EnableOther OnClick="RefreshFormProcess">Refresh</R_Button>
    </R_ItemLayout>
</R_StackLayout>
<R_StackLayout Row Class="mb-3">
<R_ItemLayout xs="3">
    <R_Grid @ref="_gridRef"
            DataSource="_viewModel.BudgetDTList"
            Pageable
            R_ConductorSource="_conductorRef"
            R_GridType="R_eGridType.Navigator"
            R_ServiceGetListRecord="GetBudgetDTList">
        <R_GridColumns>
            <R_GridTextColumn FieldName="CGLACCOUNT_NO" HeaderText="Account No."/>
            <R_GridTextColumn FieldName="CCENTER_CODE" HeaderText="Center"/>
        </R_GridColumns>
    </R_Grid>
</R_ItemLayout>
<R_ItemLayout xs="9">
<R_GroupBox ShowBorder Class="px-3 py-2" Title="Detail">
<R_StackLayout Row Class="mb-2">
    <R_ItemLayout xs="2">
        <R_Label>Account No.</R_Label>
    </R_ItemLayout>
    <R_ItemLayout xs="2">
        <R_TextBox @ref="FieldAcc" @bind-Value="_viewModel.Data.CGLACCOUNT_NO"
                   R_ConductorSource="_conductorRef"
                   MaxLength="20"
                   R_EnableAdd/>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Lookup R_ConductorSource="_conductorRef"
                  R_EnableAdd
                  R_Before_Open_Lookup="BeforeOpenLookupAccount"
                  R_After_Open_Lookup="AfterOpenLookupAccount">
        </R_Lookup>
    </R_ItemLayout>
    <R_ItemLayout xs="6">
        <R_TextBox @bind-Value="_viewModel.Data.CGLACCOUNT_NAME"
                   R_ConductorSource="_conductorRef"
                   CharacterCasing="R_eCharacterCasing.Upper"
                   Enabled="false"/>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row Class="mb-2">
    <R_ItemLayout xs="2">
        <R_Label>Center</R_Label>
    </R_ItemLayout>
    <R_ItemLayout xs="2">
        <R_TextBox @ref="FieldCenterCode" @bind-Value="_viewModel.Data.CCENTER_CODE"
                   R_ConductorSource="_conductorRef"
                   CharacterCasing="R_eCharacterCasing.Upper"
                   MaxLength="10"
                   R_EnableAdd
                   R_EnableEdit/>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Lookup @ref="LookupCenterCode" R_ConductorSource="_conductorRef"
                  R_Before_Open_Lookup="BeforeOpenLookupCenter"
                  R_After_Open_Lookup="AfterOpenLookupCenter"
                  R_EnableAdd
                  R_EnableEdit>
        </R_Lookup>
    </R_ItemLayout>
    <R_ItemLayout xs="6">
        <R_TextBox @bind-Value="_viewModel.Data.CCENTER_NAME"
                   R_ConductorSource="_conductorRef"
                   CharacterCasing="R_eCharacterCasing.Upper"
                   Enabled="false"/>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row Class="mb-2">
    <R_ItemLayout xs="2">
        <R_Label>Input Method</R_Label>
    </R_ItemLayout>
    <R_ItemLayout xs="10">
        <R_RadioGroup Data="@_viewModel.CINPUT_METHOD"
                      @bind-Value="_viewModel.Data.CINPUT_METHOD"
                      ValueField="Key"
                      TextField="Value"
                      R_ConductorSource="@_conductorRef"
                      R_EnableAdd
                      R_EnableEdit
                      OnChanged="ChangeInputMethod"/>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row Class="mb-2">
    <R_ItemLayout xs="6">
        <R_StackLayout Row>
            <R_ItemLayout xs="4">
                <R_Label>Budget</R_Label>
            </R_ItemLayout>
            <R_ItemLayout xs="4">
                <R_NumericTextBox @ref="FieldBudget"
                                  @bind-Value="_viewModel.Data.NBUDGET"
                                  R_ConductorSource="_conductorRef"
                                  R_EnableAdd
                                  R_EnableEdit/>
            </R_ItemLayout>
        </R_StackLayout>
    </R_ItemLayout>
    <R_ItemLayout xs="6">
        <R_StackLayout Row>
            <R_ItemLayout xs="3">
                <R_Label>Rounding Method</R_Label>
            </R_ItemLayout>
            <R_ItemLayout xs="6">
                <R_ComboBox @ref="FieldRoundingMethod" Data="@_viewModel.RoundingMethodList"
                            @bind-Value="_viewModel.Data.CROUNDING_METHOD"
                            ValueField="@nameof(GLM00500FunctionDTO.CCODE)"
                            TextField="@nameof(GLM00500FunctionDTO.CDESCRIPTION)"
                            R_ConductorSource="@_conductorRef"
                            R_EnableAdd
                            R_EnableEdit/>
            </R_ItemLayout>
        </R_StackLayout>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row Class="mb-4">

    <R_ItemLayout xs="6">
        <R_StackLayout Row>
            <R_ItemLayout xs="4">
                <R_Label>Distribution Method</R_Label>
            </R_ItemLayout>
            <R_ItemLayout>
                <R_RadioGroup @ref="FieldDistributionMethod" Data="@_viewModel.CDIST_METHOD"
                              @bind-Value="_viewModel.Data.CDIST_METHOD"
                              ValueField="Key"
                              TextField="Value"
                              R_ConductorSource="@_conductorRef"
                              R_EnableAdd
                              R_EnableEdit
                              OnChanged="ChangeDistMethod"/>
            </R_ItemLayout>
        </R_StackLayout>
    </R_ItemLayout>
    <R_ItemLayout xs="6">
        <R_StackLayout Row>
            <R_ItemLayout xs="3">
                <R_Label>Weighting Code</R_Label>
            </R_ItemLayout>
            <R_ItemLayout xs="6">
                <R_ComboBox @ref="FieldWeightingCode" 
                            Data="@_viewModel.BudgetWeightingList"
                            @bind-Value="_viewModel.Data.CBW_CODE"
                            ValueField="@nameof(GLM00500BudgetWeightingDTO.CBW_CODE)"
                            TextField="@nameof(GLM00500BudgetWeightingDTO.CBW_NAME_DISPLAY)"
                            R_ConductorSource="@_conductorRef"
                            R_EnableAdd
                            R_EnableEdit/>
            </R_ItemLayout>
            <R_ItemLayout>
                <R_Button R_ConductorSource="_conductorRef" Enabled="@(_viewModel.Data.CINPUT_METHOD == "AN")" R_EnableAdd R_EnableEdit>Calculate</R_Button>
            </R_ItemLayout>
        </R_StackLayout>
    </R_ItemLayout>

</R_StackLayout>

<R_StackLayout>
    <R_ItemLayout>
        <R_Label Class="text-primary fw-bold">Budget</R_Label>
    </R_ItemLayout>
</R_StackLayout>

<R_GroupBox Enabled="@(_viewModel.Data.CINPUT_METHOD == "MN")" ShowBorder="false">
    <R_StackLayout Row Spacing="2" Class="mb-5">
        <R_ItemLayout xs="4">
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 1</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod1" @bind-Value="_viewModel.Data.NPERIOD1"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 2</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod2" @bind-Value="_viewModel.Data.NPERIOD2"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 3</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod3" @bind-Value="_viewModel.Data.NPERIOD3"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 4</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod4" @bind-Value="_viewModel.Data.NPERIOD4"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 5</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod5" @bind-Value="_viewModel.Data.NPERIOD5"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout xs="4">
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 6</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod6" @bind-Value="_viewModel.Data.NPERIOD6"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 7</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod7" @bind-Value="_viewModel.Data.NPERIOD7"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 8</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod8" @bind-Value="_viewModel.Data.NPERIOD8"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 9</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod9" @bind-Value="_viewModel.Data.NPERIOD9"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 10</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod10" @bind-Value="_viewModel.Data.NPERIOD10"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout xs="4">
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 11</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod11" @bind-Value="_viewModel.Data.NPERIOD11"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 12</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod12" @bind-Value="_viewModel.Data.NPERIOD12"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 13</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod13" @bind-Value="_viewModel.Data.NPERIOD13"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 14</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod14" @bind-Value="_viewModel.Data.NPERIOD14"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout xs="3">
                    <R_Label>Period 15</R_Label>
                </R_ItemLayout>
                <R_ItemLayout xs="7">
                    <R_NumericTextBox @ref="FieldPeriod15" @bind-Value="_viewModel.Data.NPERIOD15"
                                      R_ConductorSource="_conductorRef"
                                      R_EnableAdd
                                      R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
</R_GroupBox>

<R_StackLayout Row Spacing="3" Class="d-flex justify-content-end mb-1">
    <R_ItemLayout>
        <R_Label>Updated By</R_Label>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_TextBox @bind-Value="@_viewModel.Data.CUPDATE_BY" Enabled="false"/>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_DateTimePicker @bind-Value="@_viewModel.Data.DUPDATE_DATE" Enabled="false"/>
    </R_ItemLayout>
</R_StackLayout>
<R_StackLayout Row Spacing="3" Class="d-flex justify-content-end">
    <R_ItemLayout>
        <R_Label>Created By</R_Label>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_TextBox @bind-Value="@_viewModel.Data.CCREATE_BY" Enabled="false"/>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_DateTimePicker @bind-Value="@_viewModel.Data.DCREATE_DATE" Enabled="false"/>
    </R_ItemLayout>
</R_StackLayout>

</R_GroupBox>
</R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row>
    <R_ItemLayout xs="1">
        <R_AddButton R_Conductor="_conductorRef" Enabled="@(_viewModel.BudgetHDEntity.LFINAL == false)"/>
    </R_ItemLayout>
    <R_ItemLayout xs="1">
        <R_EditButton R_Conductor="_conductorRef" Enabled="@(_viewModel.BudgetHDEntity.LFINAL == false)"/>
    </R_ItemLayout>
    <R_ItemLayout xs="1" Class="me-5">
        <R_DeleteButton R_Conductor="_conductorRef" Enabled="@(_viewModel.BudgetHDEntity.LFINAL == false)"/>
    </R_ItemLayout>

    <R_ItemLayout xs="1">
        <R_CancelButton R_Conductor="_conductorRef"/>
    </R_ItemLayout>
    <R_ItemLayout xs="1">
        <R_SaveButton R_Conductor="_conductorRef"/>
    </R_ItemLayout>
</R_StackLayout>


<R_Conductor @ref="@_conductorRef"
             R_ViewModel="@_viewModel"
             R_IsHeader="true"
             R_ServiceGetRecord="@GetBudgetDT"
             R_Display="Display"
             R_AfterAdd="AfterAdd"
             R_Validation="Validation"
             R_ServiceSave="Save"
             R_ServiceDelete="Delete"
             />