@page "/GLM00500"
@using R_BlazorFrontEnd.Controls.Events
@inherits R_Page
@attribute [R_Page(Title = "List")]

<R_StackLayout Row Class="mb-1">
    <R_ItemLayout Class="me-4">
        <R_Label>Year</R_Label>
    </R_ItemLayout>
    <R_ItemLayout col="2">
        <R_NumericTextBox
            @bind-Value="@_viewModel.SelectedYear"
            Min="@_viewModel.Periods.IMIN_YEAR"
            Max="@_viewModel.Periods.IMAX_YEAR"
            R_ConductorSource="_conductorRef"
            R_EnableOther="true"
            Step="1" ThousandSeparator="false"/>
    </R_ItemLayout>
    <R_ItemLayout col="1">
        <R_Button OnClick="RefreshList" R_ConductorSource="_conductorRef" R_EnableOther="true">Refresh</R_Button>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Class="mb-1">
    <R_ItemLayout>
        <R_Grid @ref="_gridRef"
                DataSource="_viewModel.BudgetHDList"
                Pageable="true"
                R_ConductorSource="_conductorRef"
                R_GridType="R_eGridType.Navigator"
                R_ServiceGetListRecord="GetBudgetHDList"
                Height="250px">
            <R_GridColumns>
                <R_GridTextColumn FieldName="CBUDGET_NO" HeaderText="Budget No." Width="100px"/>
                <R_GridTextColumn FieldName="CBUDGET_NAME" HeaderText="Budget Name" Width="150px"/>
                <R_GridTextColumn FieldName="CCURRENCY_TYPE_NAME" HeaderText="Currency Type" Width="120px"/>
                <R_GridCheckBoxColumn FieldName="LFINAL" HeaderText="Final" Width="80px"/>
                <R_GridTextColumn FieldName="CUPDATE_BY" HeaderText="Updated By" Width="120px"/>
                <R_GridDateTimePickerColumn FieldName="DUPDATE_DATE" HeaderText="Updated Date" Width="150px"/>
                <R_GridTextColumn FieldName="CCREATE_BY" HeaderText="Created By" Width="120px"/>
                <R_GridDateTimePickerColumn FieldName="DCREATE_DATE" HeaderText="Created Date" Width="150px"/>
            </R_GridColumns>

        </R_Grid>
    </R_ItemLayout>
</R_StackLayout>

<R_GroupBox ShowBorder="false" Class="mb-3 px-2">
    <R_StackLayout Row>
        <R_ItemLayout col="6">
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout col="3">
                    <R_Label>Budget No.</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @ref="FieldBudgetNo" @bind-Value="_viewModel.Data.CBUDGET_NO"
                               R_ConductorSource="_conductorRef"
                               MaxLength="20"
                               R_EnableAdd/>
                </R_ItemLayout>
                <R_ItemLayout col="2">
                    <R_CheckBox @bind-Value="_viewModel.Data.LFINAL"
                                R_ConductorSource="_conductorRef"
                                Enabled="false"/>
                    <R_Label>Final</R_Label>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout col="3">
                    <R_Label>Budget Name</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="8">
                    <R_TextBox @bind-Value="_viewModel.Data.CBUDGET_NAME"
                               R_ConductorSource="_conductorRef"
                               MaxLength="50"
                               R_EnableAdd
                               R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>Currency Type</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_ComboBox Data="_viewModel.CurrencyTypeList"
                                @bind-Value="_viewModel.Data.CCURRENCY_TYPE"
                                ValueField="@nameof(GLM00500FunctionDTO.CCODE)"
                                TextField="@nameof(GLM00500FunctionDTO.CDESCRIPTION)"
                                R_ConductorSource="_conductorRef"
                                R_EnableAdd
                                R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="6">
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout col="3">
                    <R_Label>Updated By</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="_viewModel.Data.CUPDATE_BY"
                               R_ConductorSource="_conductorRef" Enabled="false"/>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_DateTimePicker @bind-Value="_viewModel.Data.DUPDATE_DATE"
                                      R_ConductorSource="_conductorRef" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>Created By</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="_viewModel.Data.CCREATE_BY"
                               R_ConductorSource="_conductorRef" Enabled="false"/>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_DateTimePicker @bind-Value="_viewModel.Data.DCREATE_DATE"
                                      R_ConductorSource="_conductorRef" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
</R_GroupBox>

<R_StackLayout Row Class="d-flex justify-content-between">
    <R_StackLayout Row>
        <R_ItemLayout col="4">
            <R_AddButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout col="4">
            <R_EditButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout col="4">
            <R_DeleteButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row>
        <R_ItemLayout col="4">
            <R_Button
                OnClick="SetFinal"
                R_ConductorSource="_conductorRef"
                R_EnableOther="true">
                Final
            </R_Button>
        </R_ItemLayout>
        <R_ItemLayout col="4">
            <R_Popup
                R_ConductorSource="_conductorRef"
                R_EnableOther="true"
                R_Before_Open_Popup="BeforeOpenUpload"
                R_After_Open_Popup="AfterOpenUpload">
                Upload
            </R_Popup>
        </R_ItemLayout>
        <R_ItemLayout col="4">
            <R_Button
                OnClick="DownloadTemplate"
                R_ConductorSource="_conductorRef"
                R_EnableOther="true">
                Template
            </R_Button>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row>
        <R_ItemLayout col="7">
            <R_CancelButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout col="4">
            <R_SaveButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
    </R_StackLayout>
</R_StackLayout>

<R_Conductor @ref="@_conductorRef"
             R_ViewModel="@_viewModel"
             R_IsHeader="true"
             R_Display="@Display"
             R_ServiceGetRecord="@GetBudgetHD"
             R_Validation="@ValidationBudgetHD"
             R_ServiceSave="@SaveBudgetHD"
             R_ServiceDelete="@DeleteBudgetHD"
             R_AfterDelete="@AfterDeleteBudgetHD"
             R_BeforeCancel="@BeforeCancelBudgetHD"/>

<R_PredefinedDock R_InstantiateDock="InstanceDetailTab" Title="Detail" Enabled="@(_viewModel.BudgetHDList.Count > 0)"/>